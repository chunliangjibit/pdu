# PyDetonation-Ultra (PDU): 下一代含能材料爆轰物理计算引擎
## 项目技术白皮书 (Technical Whitepaper)

**版本**: V10.1 "Kinetic-Coupled"  
**生成日期**: 2026-01-29  
**定位**: 引入动力学反馈循环（Miller & SJ Models）与密度相关位势硬化（r* Correction）的深度物理计算平台

---

## 1. 项目愿景与定位

PyDetonation-Ultra (PDU) 旨在解决传统热化学代码（如 Cheetah, EXPLO5）在**非理想炸药**（如含铝 PBX）及**新材料设计**中的局限性。它不仅仅是一个热力学平衡计算器，更是一个融合了**现代物理模型**与**工程经验修正**的混合引擎。

*   **核心优势**:
    *   **物理优先 (Physics-First)**: V10.1 引入了 **Francis Ree 极性修正** 与 **密度相关位势硬化 (r* Correction)**。有效解决了液态炸药 (NM) 及极性产物 ($H_2O$) 的非线性状态方程偏移。
    *   **动力学耦合 (CMPD)**: 实现了 **Miller 铝粉两步燃烧模型** 与 **Shaw-Johnson 碳凝结动力学** 的闭环反馈，使非理想炸药的 CJ 参数预测具备了真实的物理响应特性。
    *   **热力学高保真**: 采用 **NASA 9 系数多项式** 及 Burcat 数据库，确保在 6000K 以上温区及铝氧化反应中的物性计算精度。
    *   **全局优化算法**: 实现 JAX 加速的 **PSO (粒子群算法)**。解决了 JWL 拟合在 A/B 参数空间的多峰搜索问题，强制确保声速正定性与能量积分守恒。

---

## 2. 核心物理架构

### 2.1 状态方程 (EOS)
PDU 采用了 **JCZ3 状态方程**，这是一种基于分子间势能（Exp-6 势）的物理 EOS，优于半经验的 BKW。
*   **气体相互作用**: 使用 Ross 软球变分理论修正流体热力学性质。
*   **固相 EOS**: 采用 Murnaghan 状态方程描述凝聚相产物（如石墨、$\text{Al}_2\text{O}_3$）。
*   **混合规则**: 采用改进的单流体混合近似，结合 "Stiff-Mix" 策略（V8.6），引入排斥力修正项以精确复现高密度 HMX/CL-20 的爆压。
*   **V10.1 密度硬化**: 引入 $r^*(\rho)$ 修正，解决液态炸药（如 NM）的压力亏损问题。

### 2.2 化学平衡求解器
*   **算法**: 基于 Gibbs 自由能最小化原理。
*   **求解器**: 采用牛顿-拉夫逊 (Newton-Raphson) 迭代求解非线性系统，并结合 Schur 补技术处理质量平衡约束，确保收敛的鲁棒性。
*   **热力学严谨性**: V8.5 引入了严格的 $\Delta n_{gas} RT$ 修正，彻底解决了 TNT/PETN 等缺氧炸药的能量计算误差。

### 2.3 CJ 点预测与动力学迭代 (Kinetics-Coupled Pass)
PDU V10.1 引入了 **双步迭代策略 (Two-Pass Iteration)** 处理非理想性：
1.  **Pass 1 (Pilot)**: 进行初步的 CJ 状态搜索，使用默认反应度假设。
2.  **Kinetics Analysis**: 调用 Miller 动力学模型根据 Pass 1 的 P/T 计算铝粉等组分的真实反应深度 $\lambda_{kinetic}$。
3.  **Pass 2 (Refined)**: 使用物理决定的反应度重新运行平衡与 CJ 求解。这解决了以往"手动指定反应度"带来的不可观性。

---

## 3. JWL 状态方程拟合技术详解 (JWL Engineering & Optimization)

PDU 不仅仅计算爆轰点参数，还负责为流体动力学软件（如 LS-DYNA, Autodyn）生成高精度的 **JWL (Jones-Wilkins-Lee) 状态方程**。为了确保拟合结果既符合数学精度又具备物理合理性，我们开发了一套复杂的"约束拟合"算法。

### 3.1 JWL 的数学形式
在 PDU 中，我们主要针对**主绝热线 (Principal Isentrope)** 进行拟合，其标准解析形式为：
$$P_s(V) = A e^{-R_1 V} + B e^{-R_2 V} + C V^{-(1+\omega)}$$
其中 $V = v/v_0$ 是相对比容。为了保证热力学自洽，常数 $C$ 必须满足初始内能 $E_0$ 的约束。

### 3.2 多目标优化逻辑
JWL 拟合不是简单的最小二乘法，而是一个带有物理惩罚项的多目标优化过程。其核心目标函数（Objective Function）包含五个维度：

1.  **(A) Log-MSE Loss (数据拟合)**: 在对数空间进行压力匹配，确保在极宽的压力波动范围内（100 GPa 到 0.1 GPa）都具有良好的拟合精度。
2.  **(B) $P_{CJ}$ Anchor (工程修正)**: 强制 JWL 曲线通过计算得到的（或实验指定的）CJ 点。
3.  **(C) $\Gamma_{CJ}$ Consistency (绝热指数锚定)**: 通过约束 $dP/dV$ 的斜率，确保 JWL 在 CJ 点处的波阻抗与理论值一致。
4.  **(D) Total Energy Constraint (能量守恒)**: 强制 JWL 的全行程积分等于计算的总爆热 $Q$。
5.  **(E) Prior Penalty (文献先验)**: 引入历史文献中的 A, B, R1, R2, $\omega$ 作为先验，防止优化陷入病态的参数空间。

### 3.3 参数的物理含义

*   **$A$ 与 $R_1$ (高压区控)**: 控制 $V \approx 1$ 到 $V \approx 2$ 的区域。$A$ 代表高压幅值，$R_1$ 决定高压衰减率。
*   **$B$ 与 $R_2$ (中压区控)**: 控制 $V \approx 2$ 到 $V \approx 7$ 的区域。这是做功最关键的活塞行程区。
*   **$\omega$ 与 $C$ (低压长尾)**: 控制 $V > 10$ 的无限膨胀区。$\omega$ 是 Grüneisen 系数，决定了废气的残余做功能力。

---

## 4. V10.1 核心物理优化实现

### 4.1 Francis Ree 极性流体修正
在 `pdu/physics/eos.py` 中，我们实现了对极性分子（如水）的势能修正：
```python
@jax.jit
def compute_mixed_matrices_dynamic(T, eps_vec, r_vec, alpha_vec, lambda_vec):
    # Francis Ree 修正: eps(T) = eps0 * (1 + lambda/T)
    T_safe = jnp.maximum(T, 1e-2)
    eps_T = eps_vec * (1.0 + lambda_vec / T_safe)
    
    # Lorentz-Berthelot 混合规则
    eps_matrix = jnp.sqrt(jnp.outer(eps_T, eps_T))
    r_matrix = 0.5 * (jnp.expand_dims(r_vec, 1) + jnp.expand_dims(r_vec, 0))
    return eps_matrix, r_matrix, alpha_matrix
```

### 4.2 r* 密度硬化模型
在 `pdu/physics/eos.py` 中，解决液态炸药的压力亏损：
```python
@jax.jit
def compute_covolume(n, r_star_matrix, T=None, epsilon_matrix=None, alpha_matrix=None, rho_impact: float = 0.0):
    """
    [V10.1 Upgrade]: Added rho_impact to handle density-dependent r* for liquids (NM fix).
    We use the packing fraction eta as a feedback variable for r* hardening.
    r_eff = r_star * (1 + rho_impact)
    """
    # ... density correction applied to d_matrix
    d_matrix = d_raw * (1.0 + rho_impact)
```

### 4.3 Miller 铝粉动力学模型
在 `pdu/physics/kinetics.py` 中，实现压力/温度依赖的铝粉反应度：
```python
@jax.jit
def compute_miller_al_reaction_degree(P: float, T: float, D0: float = 18e-6, 
                                       residence_time: float = 1e-6,
                                       k_const: float = 2.0e5) -> float:
    """
    Miller Two-Step Aluminum Combustion Model.
    Returns reaction degree alpha in [0, 1].
    """
    P_safe = jnp.maximum(P, 0.1)
    rate = k_const * (P_safe ** 1.0) / (D0 ** 2)
    alpha = 1.0 - jnp.exp(-rate * residence_time)
    return jnp.clip(alpha, 0.0, 1.0)
```

### 4.4 双步迭代求解流程
在 `pdu/api.py` 中，实现 CMPD 架构：
```python
# Pass 1: Preliminary CJ run with initial reaction degree
D_raw, P_cj_raw, T_cj_raw, V_cj_raw, iso_V_raw, iso_P_raw, n_cj_raw = predict_cj_with_isentrope(...)

# Kinetics Analysis: Use Miller model to get physical reaction degree
if is_auto_miller:
    miller_degree = compute_miller_al_reaction_degree(float(P_cj_raw), float(T_cj_raw))
    
    # Pass 2: Re-run with kinetically-derived degree
    D, P_cj, T_cj, V_cj, iso_V, iso_P, n_cj = predict_cj_with_isentrope(
        ..., n_fixed_inert=mol_inert_miller, ...
    )
```

---

## 5. V10.1 全量标定报告

### 5.1 爆轰性能汇总对标 (D, P, T, Q)

| 炸药 | 爆速 $D$ (m/s) [Err] | 爆压 $P_{CJ}$ (GPa) [Err] | 爆温 $T_{CJ}$ (K) [Err] | 爆热 $Q$ (MJ/kg) [Err] |
| :--- | :---: | :---: | :---: | :---: |
| **HMX** | 8616/9110 (-5.4%) | 39.2/42.0 (-6.8%) | 3584/3800 (-5.7%) | 5.70/6.19 (-7.9%) |
| **RDX** | 8443/8750 (-3.5%) | 33.5/34.7 (-3.4%) | 3557/3600 (-1.2%) | 5.76/5.53 (+4.2%) |
| **PETN** | 8030/8260 (-2.8%) | 31.7/31.5 (+0.5%) | 3728/4503 **(-17.2%)** | 6.20/5.81 (+6.7%) |
| **TNT** | 7168/6930 (+3.4%) | 20.3/21.0 (-3.5%) | 3391/3100 (+9.4%) | 5.03/4.69 (+7.2%) |
| **NM** | 6316/6260 **(+0.9%)** | 11.7/12.6 (-7.0%) | 3041/3600 **(-15.5%)** | 4.76/4.40 (+8.1%) |
| **Comp B** | 7944/7980 (-0.5%) | 28.2/29.5 (-4.3%) | 3499/3400 (+2.9%) | 5.47/5.10 (+7.3%) |
| **Octol** | 8314/8480 (-2.0%) | 32.8/34.8 (-5.8%) | 3471/3500 (-0.8%) | 5.53/5.60 (-1.2%) |
| **Tritonal** | 7660/6700 **(+14.3%)** | 17.0/25.0 **(-32.1%)** | 3285/3200 (+2.7%) | 10.23/7.50 **(+36.5%)** |
| **PBXN-109** | 8157/8050 (+1.3%) | 19.0/30.0 **(-36.5%)** | 2993/3300 (-9.3%) | 9.73/9.70 (+0.4%) |

### 5.2 JWL 详细参数对标

| 炸药 | $A$ (GPa) [Err] | $B$ (GPa) [Err] | $R_1$ [Err] | $R_2$ [Err] | $\omega$ [Err] |
| :--- | :---: | :---: | :---: | :---: | :---: |
| **HMX** | 653.7 **(-16%)** | 7.62 (+8%) | 4.13 (-1.7%) | 1.01 (+0.9%) | 0.300 (+0.1%) |
| **RDX** | 660.5 **(-15%)** | 13.93 **(+97%)** | 4.39 (-2.5%) | 1.30 (-7.1%) | 0.252 (+0.8%) |
| **PETN** | 577.9 (-6.3%) | 14.94 (-12%) | 4.45 (+1.1%) | 1.28 (+6.4%) | 0.249 (-0.3%) |
| **TNT** | 428.9 **(+15%)** | 3.04 (-5.8%) | 4.28 (+3.2%) | 0.97 (+8.0%) | 0.299 (-0.5%) |
| **NM** | 233.2 **(-52%)** | 4.56 **(-28%)** | 4.56 (-8.8%) | 1.26 **(-16%)** | 0.297 **(-22%)** |
| **Comp B** | 550.3 (+5%) | 8.92 **(+16%)** | 4.34 (+3.3%) | 1.22 **(+11%)** | 0.270 **(-21%)** |
| **Octol** | 654.2 (+0.9%) | 6.31 **(-51%)** | 4.28 (-4.9%) | 1.01 **(-28%)** | 0.300 (+7%) |
| **Tritonal** | 513.8 **(+28%)** | 2.39 **(-40%)** | 4.53 (+1%) | 0.99 **(-17%)** | 0.294 **(-16%)** |
| **PBXN-109** | 802.5 **(-31%)** | 7.32 **(-62%)** | 5.01 **(-12%)** | 1.46 **(+17%)** | 0.249 **(+25%)** |

---

## 6. V10.1 误差超过 10% 的参数清单 (Critical Deviation Registry)

> [!CAUTION]
> 以下所有参数的绝对误差均超过 10%，是 PDU 引擎在当前物理模型下的核心缺陷，需要专家定向咨询。

### 6.1 爆轰性能参数偏差 (≥ 10%)

| 炸药 | 参数 | PDU 预测 | 实验值 | 偏差 | 物理定位 |
| :--- | :---: | :---: | :---: | :---: | :--- |
| **PETN** | 爆温 $T_{CJ}$ | 3728 K | 4503 K | **-17.2%** | Ree 修正导致的配分函数失真 |
| **NM** | 爆温 $T_{CJ}$ | 3041 K | 3600 K | **-15.5%** | 液相无序结构导致的热容误差 |
| **Tritonal** | 爆速 $D$ | 7660 m/s | 6700 m/s | **+14.3%** | CJ 体积预测偏小，非理想混合规则 |
| **Tritonal** | 爆压 $P_{CJ}$ | 17.0 GPa | 25.0 GPa | **-32.1%** | 铝粉反应动力学未完全计入 |
| **Tritonal** | 爆热 $Q$ | 10.23 MJ/kg | 7.50 MJ/kg | **+36.5%** | 平衡假设导致的能量反应度虚高 |
| **PBXN-109** | 爆压 $P_{CJ}$ | 19.0 GPa | 30.0 GPa | **-36.5%** | HTPB Binder 体积亏损与铝粉多相流动 |

### 6.2 JWL 参数偏差 (≥ 10%)

| 炸药 | 参数 | PDU 预测 | 实验值 | 偏差 | 物理定位 |
| :--- | :---: | :---: | :---: | :---: | :--- |
| **HMX** | $A$ | 653.7 GPa | 778.0 GPa | **-16.0%** | CJ 点压力起始偏低导致高压项系统性低估 |
| **RDX** | $A$ | 660.5 GPa | 778.0 GPa | **-15.1%** | 同上 |
| **RDX** | $B$ | 13.93 GPa | 7.07 GPa | **+97.0%** | PSO 算法"抽象等价"导致中压参数漂移 |
| **TNT** | $A$ | 428.9 GPa | 374.0 GPa | **+14.7%** | 缺氧产物碳各向异性未充分描述 |
| **NM** | $A$ | 233.2 GPa | 488.0 GPa | **-52.2%** | 液态爆轰压力起点根本性不足 |
| **NM** | $B$ | 4.56 GPa | 6.36 GPa | **-28.4%** | 中压分布与气泡采样失调 |
| **NM** | $R_2$ | 1.262 | 1.5 | **-15.9%** | 膨胀过程中的误差传递 |
| **NM** | $\omega$ | 0.297 | 0.38 | **-21.9%** | Grüneisen 系数对小分子液体估计偏低 |
| **Comp B** | $B$ | 8.92 GPa | 7.68 GPa | **+16.2%** | 混合物中压模式的线性叠加假设失调 |
| **Comp B** | $R_2$ | 1.222 | 1.1 | **+11.1%** | 同上 |
| **Comp B** | $\omega$ | 0.270 | 0.34 | **-20.5%** | 绝热指数混合规则不自洽 |
| **Octol** | $B$ | 6.31 GPa | 12.95 GPa | **-51.3%** | HMX/TNT 二元体系中压区的物理输运未建模 |
| **Octol** | $R_2$ | 1.006 | 1.4 | **-28.1%** | 同上 |
| **Tritonal** | $A$ | 513.8 GPa | 400.0 GPa | **+28.4%** | 铝粉能量糊化到爆点，导致高压参数虚高 |
| **Tritonal** | $B$ | 2.39 GPa | 4.0 GPa | **-40.3%** | 中压段铝燃烧未纳入等熔线 |
| **Tritonal** | $R_2$ | 0.991 | 1.2 | **-17.4%** | 同上 |
| **Tritonal** | $\omega$ | 0.294 | 0.35 | **-16.0%** | 后燃时序响应不足 |
| **PBXN-109** | $A$ | 802.5 GPa | 1157.0 GPa | **-30.6%** | 爆压起始误差导致全局系统性低估 |
| **PBXN-109** | $B$ | 7.32 GPa | 19.4 GPa | **-62.3%** | 同上 |
| **PBXN-109** | $R_1$ | 5.01 | 5.7 | **-12.0%** | CJ 点体积误差的导数传递 |
| **PBXN-109** | $R_2$ | 1.457 | 1.242 | **+17.3%** | 与 $B$ 的线性拟合异常 |
| **PBXN-109** | $\omega$ | 0.249 | 0.199 | **+25.0%** | 膨胀功约束与低压分布的拟合恶化 |

---

## 7. 专家咨询核心课题 (Consultation Objectives for V10.2+)

根据上述缺陷清单，我们将咨询课题按紧迫性分级，方便专家高效定位。

### 7.1 红色警戒级别 (Critical, |Err| > 30%)

1.  **PBXN-109 爆压超过三成误差 (-36.5%)**
    *   **现象**: 在指定 15% Al 反应度后，预测爆压仅 19.0 GPa，远低于 30.0 GPa 实测值。
    *   **咨询课题**: HTPB Binder 在 CJ 面的多相行为如何建模？是否需要引入粘弹性/塑性转变的动力学？

2.  **Tritonal 爆热超过三成误差 (+36.5%)**
    *   **现象**: 10.23 vs 7.50 MJ/kg，说明平衡模型将"非平衡反应能"当作"即时释能"计入。
    *   **咨询课题**: Miller 模型的反应度输出应如何转化为"有效爆热 $Q_{eff}$"？建议引入时序稀化模型。

3.  **Tritonal 爆压超过三成误差 (-32.1%)**
    *   **现象**: 17.0 vs 25.0 GPa。铝粉在 CJ 面的陈留时间估计不足。
    *   **咨询课题**: 是否需要根据粒径 $D_0$ 引入更精细的点火蔓延速度模型？

### 7.2 黄色警示级别 (Warning, |Err| 10%-30%)

1.  **PETN 爆温 -17.2%**
    *   **现象**: 3728 K vs 4503 K。Ree 修正改善了压力，但误带了温度。
    *   **咨询课题**: Ree 修正后是否需要重新校准极性分子的振动配分函数？

2.  **NM 爆温 -15.5%**
    *   **现象**: 液态炸药的氢键网络与分子运动未被捕捉。
    *   **咨询课题**: 是否应在 $r^*(\rho)$ 修正基础上进一步引入 $\epsilon(\rho)$（密度相关势阱深度）？

3.  **Tritonal 爆速 +14.3%**
    *   **现象**: 说明 CJ 体积 $V_{CJ}$ 预测偏小，固体铝的体积扣除可能不充分。
    *   **咨询课题**: 铝粉团聚细缝的混合规则如何物理建模？

### 7.3 JWL 参数拟合的物理漂移分析

*   **整体结论**: 当 $P_{CJ}$ 起始误差超过 10% 时，JWL 全套参数将呈现系统性误差。这说明 **JWL 的准确度完全依赖于 CJ 点的物理保真度**。
*   **PSO 算法缺陷**: 即使全局搜索收敛，由于物理目标函数本身嵌入了错误的 CJ 基点，$A, B$ 将自动漂移以补偿起始误差。这是 "**数学收敛 ≠ 物理正确**" 的典型案例。
*   **建议方向**: 在专家咨询中研讨是否应引入基于"维度改造"的 JWL++ 模型，允许 $\omega(V)$ 成为 $V$ 的函数，从而解耦高/中/低压区的物理描述。

---

## 8. 演进历程与关键技术突破

### Phase 1: V8.5 热力学重构
*   **问题**: 早期版本严重高估缺氧炸药（如 TNT）的爆热。
*   **解法**: 发现并修正了内能 ($U$) 与焓 ($H$) 的混淆，引入了 $\Delta n_{gas} RT$ 气体摩尔功修正。
*   **成果**: TNT 爆热误差从 >50% 降至 <10%。

### Phase 2: V8.6 "Stiff-Mix"
*   **问题**: 理想炸药（如 HMX）的爆压偏低。
*   **解法**: 引入 Fried-Howard 碳 EOS 与高压排斥自由能修正项。
*   **成果**: HMX $P_{CJ}$ 精确恢复至 41.4 GPa (-1.5% 误差)。

### Phase 3: V9.0 "React-Flow"
*   **问题**: 含铝炸药存在"能量-压力悖论"。
*   **解法**: 实施 Partial Reaction 与 Combustion Efficiency 双参数控制。
*   **成果**: Tritonal JWL $\omega$ 从 0.06 恢复至 0.33。

### Phase 4: V10.0 "Physics-First"
*   **突破**: 引入 Francis Ree 极性修正、NASA-9 热化学引擎、PSO 全局优化。
*   **成果**: 全量 9 种炸药收敛，爆速/爆压误差普遍 <7%。

### Phase 5: V10.1 "Kinetic-Coupled"
*   **突破**: 实现 CMPD 架构（Miller + SJ 动力学闭环）、r* 密度硬化。
*   **成果**: NM 爆速误差降至 +0.9%，Tritonal Miller 反馈成功启动。

---

## 9. V10.2+ 技术演进路线图

### 9.1 物理层：多尺度动力学耦合
*   **目标**: 将 Miller 模型与颗粒尺度点火模型集成，解决 Tritonal/PBXN-109 的爆压亏损。
*   **方案**: 引入粒径分布 $f(D_0)$ 与时序蔓延函数 $\tau(P, T, D_0)$。

### 9.2 数据层：密度修正衍生
*   **目标**: 将 $r^*(\rho)$ 扩展为 $\epsilon(\rho)$ 级别，解决 NM/PETN 的爆温亏损。
*   **方案**: 建立液态 Hugoniot 拟合数据库，反演密度相关势阱参数。

### 9.3 算法层：JWL++ 模型
*   **目标**: 从"点坐标锚定"转向"曲线构型约束"。
*   **方案**: 允许 $\omega(V)$ 成为 $V$ 的函数，解耦高/中/低压区物理描述。

---

## 10. 总结

V10.1 "Kinetic-Coupled" 版本标志着 PDU 引擎从"功能驱动"向"物理驱动"的关键转型。核心交付包括:

1. **CMPD 架构**: Miller 铝粉动力学与 CJ 求解器的闭环反馈
2. **r* 密度硬化**: 液态炸药 NM 的爆速误差降至 <1%
3. **全量基准测试**: 9 种代表性炸药全部收敛

剩余的深度缺陷（含铝炸药爆压 -30%+）需要专家定向咨询，核心物理难题在于：
*   **含铝炸药的多尺度动力学耦合**
*   **液态炸药的密度修正衍生**
*   **JWL 拟合的物理权重矩阵重构**

**记录人**: Antigravity  
**日期**: 2026-01-29


### 11. 2026-01-29 V10.6 "Constrained Physics" 里程碑 - 回归物理常识

针对 V10.5 审计意见报告指出的“JWL 幽灵参数”与“含铝炸药物理失真”问题，V10.6 实施了 决定性的物理回归：

**1. 物理层：矩阵淬灭与精准热沉**
- **Matrix Quenching**: 引入了矩阵反应效率因子（~97.5%），模拟金属粉末对基体能量 释放的干扰。
- **Physical Heat Sink**: 重新标定了铝粉的热容量模型，成功将 Tritonal 爆速从 7700+ 压低至 **6293 m/s**，解决了长期困扰的非理想爆速高估问题。

**2. 数学层：物理围栏 (Physics Barriers)**
- **Grüneisen 约束**: 在 JWL Loss 函数中添加了强 Barrier，强制 $\omega$ 处于 $[0.25, 0.45]$ 区间。
- **拓扑比例约束**: 实施了 $B/A < 0.1$ 的拓扑围栏，彻底消除了 B 参数异常膨胀至 100 GPa 的数值病态。

**3. 算法层：种子化 PSO 与 Nelder-Mead 协同**
- **Seeded PSO**: 通过优化粒子群动力学，提升了全局搜索的效率。
- **Dual-Refinement**: 实现了 PSO 找到全局山谷后，由 Nelder-Mead 算法进行亚 GPa 级 的精细局部搜索，确保参数既满足物理约束，又具备极高的拟合精度。

**最终评价**: V10.6 标志着 PDU 从“数值拟合优先”转向“物理自洽优先”。生成的状态方 程参数现已具备 LS-DYNA 等商业软件的生产环境兼容性。

---

### 12. 2026-01-30 V11 转型预备 - 架构大瘦身

为了集中精力攻克 V11“两相流/多相动力学”架构，项目进行了战略性精简：

**1. 模块剔除与降噪**
- **移除逆向设计**: 删除了 `pdu/inverse/` 和 `pdu/ai/` 模块。暂时停止配方自动化搜索功能，回归正向物理内核的打磨。
- **环境归一化**: 删除了项目内嵌的 `.venv`，全面切换至全局 `mamba (nnrf)` 环境，减少环境冲突风险。

**2. API 接口纯化**
- **API 瘦身**: 简化了 `pdu/api.py`，移除了 `inverse_design` 接口，确保核心调用链路的透明度。
- **可微性保留**: 虽然移除了逆向模块，但核心物理算子依然保持全链路可微，为未来基于两相流的高级参数反演保留技术通道。

**3. 下阶段目标：两相流转型**
- 已完成《两相流转型技术咨询需求书 (V1.1)》，明确了解决“12 GPa vs 21 GPa”压力悖论的技术路线。后续将重点转向一维 ZND 反应流结构的 ODE 建模。

---

### 13. 2026-01-30 V11.0 Phase 5 - Thermodynamics Hardening (Patch A-D)

针对 V11 Phase 4 暴露出的“HMX 高密度 NaN 崩溃”与“声速伪超音速点”问题，基于专家咨询意见实施了全面的数值重构：

**1. Patch A (Smooth Barriers):**
- 彻底移除了 EOS 中所有的一阶不连续截断 (`maximum`, `clip`)。
- 对 $\eta > 0.95$ 的超饱和区引入了 C2 连续的 **Soft Barrier**，防止粒子重叠引发的负排斥与机械不稳定。
- 实现了 $V_{gas}$ 的光滑底板，消除了极小体积下的导数震荡。

**2. Patch B (NASA Smoothing):**
- 将 NASA 七系数多项式的 1000K 温区切换由硬判断改为 **Sigmoid 平滑过渡**，消除了 $C_p$ 导数尖峰。

**3. Patch C (Thermodynamic Consistency):**
- 重写了声速计算逻辑，**仅从 Helmholtz 自由能导数推导**，切断了与 Cage Correction 压力修正的耦合。
- 现在的 $a^2$ 保证了热力学一致性，彻底根除了“伪 Sonic Point”。

**4. Patch D (Robust Integration):**
- ZND 积分器升级为 **"Reject & Shrink"** 架构。
- 自动检测 NaN、$a^2 < 0$、$\eta > 1.1$ 等坏点并回退步长。

**当前状态:**
- **稳定性**: ZND 模拟器已实现 100% 稳定运行，无崩溃。
- **新挑战**: 出现了“反应停滞”现象。HMX 在 VN 点后的压强被计算为异常低的 0.12 GPa (预期 > 39 GPa)，导致点火动力学受阻。目前正针对此单位/状态初始化问题进行专项排查。

### 14. 2026-01-31 HMX Calibration Stabilization & Cold Divergence Challenge

针对 HMX V11 标定任务中的致命梗阻，完成了专项技术攻关：

**1. 物理矛盾修复**
- **单位归一化 (Reaction Stagnation Fix)**: 彻底解决了 `implicit_eos.py` 中的 SI/CGS 单位链混乱，将 VN 点初始压力从错误的 0.12 GPa 修正至正常点火区间。
- **参数解耦 (992 GPa Anomaly Fix)**: 识别并修复了产物 `r_star` 过大导致的“超高压过饱和”问题。通过将 `r_star` 调优至 **3.1 Å**，成功将 VN Spike 压强平稳降至 **57.17 GPa**（对齐 HMX 物理常识）。

**2. 求解器硬化 (Solver Hardening)**
- **Reject & Shrink 实装**: 在 `znd.py` 中完整实装了“步长回退与坏点拒绝”机制。当遇到 $T < 100$ K 或 $a^2 < 0$ 等数值陷阱时，求解器现能自动恢复并寻找物理分支，彻底告别了 `nan` 崩溃。

**3. 下阶段新挑战：冷发散 (Cold Divergence)**
- **现象发现**: 随着标定链路跑通，观测到由于 HMX 极强的膨胀做功，导致反应区后期温度急剧下跌至 140K 左右，触发了 JCZ3 在极低温下的发散风险。
- **应对方案**: 已撰写《HMX V11 稳定性与冷发散问题技术咨询需求 (V1.2)》，申请专家介入调整动力学强度与势能模型平衡。

---

### 15. 2026-01-31 V11.0 HMX 标定大功告成 - 稳健性与精度双突破

在经历了“冷发散”与“数值崩溃”的反复拉锯后，通过深度重构求解器逻辑，成功完成了 HMX 的全链路标定：

**1. 求解器架构升级 (Hybrid ZND Solver):**
- **从 Scan 到 Adaptive Loop**: 彻底放弃了固定的 `jax.lax.scan` 积分方案，在 `znd.py` 中实现了 **Python 驱动 + JIT 内核** 的自适应循环。
- **物理容错机制**: 完善了 "Reject & Shrink" 逻辑。当在爆轰波尾部遇到声速奇异性或数值不稳定时，求解器现能自动恢复并寻找物理分支，彻底告别了 `nan` 崩溃。

**2. HMX 爆轰性能精准对齐:**
- **r* 关键调优**: 通过物理参数扫描，将产物有效直径标定为 **3.045 Å**。
- **精度达成**: 爆速 $D$ 锁定 **9110 m/s** (0.0% 误差)；CJ 压力达到 **40.07 GPa** (误差 **+2.7%**)，远优于行业公认的 5% 标定容差。
### 16. 2026-01-31 GPU 加速实装与物性模型深度诊断

**1. GPU 加速全面开启**
- **环境对齐**: 解决了 `jaxlib` 与 `cuSPARSE` 的版本匹配矛盾，成功在 `nnrf` 环境下激活 RTX 4060 加速。
- **性能验证**: 通过 5000x5000 矩阵乘法验证，计算吞吐量大幅提升。目前 JAX 已默认使用 `CudaDevice(id=0)` 进行物理计算。

**2. HMX 标定状态更新 (P-D 对齐, T 偏差)**
- **压力标定**: 锁定 `r_scale=0.82`，实现 **P_CJ = 40.9 GPa** (目标 39 GPa, 误差 +5%)，爆速 **D = 9110 m/s** 精确配准。
- **温度诊断**: 发现 HMX CJ 状态填充分数 η=0.42，处于冷斥力屏障 (ETA_CAP=0.95) 的受阻区。确认为“反应物焓值释放过快”与“高温热容模型缺失”导致的爆温高估。
- **文档沉淀**: 编制并发布了《爆轰状态计算温度异常咨询报告（脱敏版）》，提出了基于高温等效热容修正的后续优化路径。

**当前状态:**
- **核心成果**: 全链路 GPU 标定环境打通，HMX 力学性能标定完成。
- **待办项**: 将 .agent/skills 纳入版本管理，准备进行多炸药联合验证。
### 17. 2026-01-31: HMX 爆温偏差咨询与 GPU 加速启用

1. **爆温异常深度诊断与咨询编制**:
    - **发现问题**: 尽管力学参数（P, D）配准，但计算爆温 (8100K) 严重偏离实验值 (4300K)。
    - **行动**: 撰写了[HMX_爆温偏差技术咨询需求书.md](file:///home/jcl/HDY/PyDetonation-Ultra/documents/HMX_爆温偏差技术咨询需求书.md)，明确提出从势能阱深度 ($\epsilon/k$) 和 NASA 高压热容修正入手“压低”爆温的技术建议。
    - **环境同步**: 成功启用 GPU 加速，通过 Conda 挂钩实现路径自动配置，显著提升后续大规模平衡扫参的效率。
- **稳定性验证**: 在不使用人工粘性或平滑因子的前提下，爆轰波平稳推进至 99.5% 反应进度，证明了 Patch A-E 组合拳的威力。

**3. JWL 产出与可微性验证:**
- **自动化拟合**: 成功从 JCZ3 膨胀等熵线提取数据，并拟合出满足物理围栏约束（$\omega=0.45, B/A < 0.1$）的 JWL 参数集。
- **JAX 兼容性修复**: 解决了 `isentrope.py` 中的追踪器布尔转换错误（TracerBoolConversionError），确保了全流程的快速 JIT 编译能力。

**当前状态:**
- **里程碑达成**: V11 气相产物标定流程已彻底跑通，且具备极强的数值稳健性。
- **后续路线**: 准备进入 **RDX/PETN/TNT** 的联合标定验证，并开始向真正的 **两相流/含铝炸药** 场景迁移。
### 18. 2026-01-31 V11.0 Phase 6 - Calibration Stabilization & Codebase Streamlining

针对专家反馈提出的工程合规性、热力学稳定性及项目赘余问题，完成了决定性的攻坚与清理：

**1. HMX 爆温偏差彻底解决 (Sweet Spot Landing):**
- **A' 方案优化**: 确立了 $u_{inf}=4.0\text{ MJ/kg}$ 与 $r_{star}=3.136\text{ Å}$ 的最优参数组合。
- **性能配准**: $P_{CJ}$ 锁定 **38.9 GPa** (误差 < 0.3%)，爆速 $D$ 锁定 **9110 m/s**，爆温成功压低至 **4545 K**（从 8600K 回归物理区间），扫清了 V11 架构落地最大的物理梗阻。

**2. 工程合规化与标准化:**
- **NASA-9 集成**: 更新了 H₂/O₂/C 的九系数多项式，确保高温热容外推的数学精度。
- **三联输出标准**: 实现了热容的【总量、质量比、摩尔比】联动诊断，消除了单位口径歧义。
- **渐近性验证**: 压力趋势扫描证实在 $V=1000\text{ cm}^3\text{/mol}$ 时偏差小于 3%，确认 EOS 具备良好的理想气渐近性。

**3. 项目深度净空:**
- **去除赘余**: 删除了标定过程中产生的所有 15+ 个临时日志脚本及冗余诊断。
- **数据坏账清理**: 移除了 404 损坏的数据文件，确保 `pdu/data` 的纯净度。

**当前状态:**
- **核心逻辑**: 已形成一套高健壮性的“专家级标定工作流”。
- **后续路线**: 
    1. **HMX 闭环**: 完成 HMX 全部基础爆轰参数（D, P, T, Q）及全温域 JWL 状态方程参数的 final fitting。
    2. **单质药扩展**: 启动 RDX, PETN, TNT 等标准单质炸药的批量标定，建立标准物性库。
    3. **混合药挑战**: 进入含铝、含粘结剂混合炸药的多相流标定阶段，验证 PDU 引擎在复杂非理想组分下的预测力。

---
